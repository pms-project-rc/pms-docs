///////////////////////////////////////////////////////
// Car Wash & Parking Management System - Domain Model
// Updated: 2025-11-27
// Includes: All recent schema updates (shift_id, admin_id, helmet_count, etc.)
///////////////////////////////////////////////////////

// === USERS & ROLES ===
Table global_admins {
  id integer [pk, increment]
  email varchar [unique, not null]
  password_hash varchar [not null]
  full_name varchar [not null]
  phone varchar
  is_active boolean [default: true]
  last_login timestamp
  created_at timestamp [default: `now()`]
  updated_at timestamp
}

Table operational_admins {
  id integer [pk, increment]
  email varchar [unique, not null]
  password_hash varchar [not null]
  full_name varchar [not null]
  phone varchar
  is_active boolean [default: true]
  last_login timestamp
  created_at timestamp [default: `now()`]
  updated_at timestamp
}

Table washers {
  id integer [pk, increment]
  email varchar [unique, not null]
  password_hash varchar [not null]
  full_name varchar [not null]
  phone varchar
  commission_percentage integer [default: 0, note: '0-100']
  is_active boolean [default: true]
  last_login timestamp
  created_at timestamp [default: `now()`]
  updated_at timestamp
}

// Password recovery tokens
Table password_reset_tokens {
  id integer [pk, increment]
  user_type varchar [not null, note: 'global_admin, operational_admin, washer']
  user_id integer [not null]
  token varchar [unique, not null]
  expires_at timestamp [not null]
  is_used boolean [default: false]
  used_at timestamp
  created_at timestamp [default: `now()`]
}

// === VEHICLES, SERVICES & OPERATIONS ===
Table vehicles {
  id integer [pk, increment]
  plate varchar [unique, not null]
  owner_name varchar [not null]
  owner_phone varchar
  vehicle_type varchar [not null, note: 'Moto, Carro, etc.']
  brand varchar
  model varchar
  color varchar
  is_frequent boolean [default: false]
  notes varchar
  created_at timestamp [default: `now()`]
  updated_at timestamp
}

Table washing_services {
  id integer [pk, increment]
  vehicle_id integer [not null, ref: > vehicles.id]
  parking_record_id integer [unique, ref: - parking_records.id]
  washer_id integer [ref: > washers.id]
  shift_id integer [not null, ref: > shifts.id]
  admin_id integer [not null, ref: > operational_admins.id]
  service_type varchar [not null]
  service_date timestamp [not null]
  price integer [not null, note: 'En centavos']
  payment_status varchar [default: 'pending']
  notes varchar
  created_at timestamp [default: `now()`]
  updated_at timestamp
}

Table parking_records {
  id integer [pk, increment]
  vehicle_id integer [not null, ref: > vehicles.id]
  shift_id integer [not null, ref: > shifts.id]
  admin_id integer [not null, ref: > operational_admins.id]
  entry_time timestamp [not null]
  exit_time timestamp
  parking_rate_id integer [not null, ref: > rates.id]
  subscription_id integer [ref: > monthly_subscriptions.id]
  washing_service_id integer [ref: > washing_services.id]
  helmet_count integer [default: 0]
  helmet_charge integer [default: 0, note: 'En centavos']
  total_cost integer [default: 0, note: 'En centavos']
  payment_status varchar [default: 'pending']
  notes varchar
  created_at timestamp [default: `now()`]
  updated_at timestamp
}

Table shifts {
  id integer [pk, increment]
  admin_id integer [not null, ref: > operational_admins.id]
  shift_date date [not null]
  start_time timestamp [not null]
  end_time timestamp
  initial_cash integer [default: 0, note: 'En centavos']
  final_cash integer [note: 'En centavos']
  total_income integer [default: 0, note: 'En centavos']
  total_expenses integer [default: 0, note: 'En centavos']
  notes varchar
  created_at timestamp [default: `now()`]
  updated_at timestamp
}

Table expenses {
  id integer [pk, increment]
  shift_id integer [ref: > shifts.id]
  expense_type varchar [not null]
  amount integer [not null, note: 'En centavos']
  description varchar [not null]
  expense_date date [not null]
  created_at timestamp [default: `now()`]
  updated_at timestamp
}

// === PAYMENT & BONUSES ===
Table bonuses {
  id integer [pk, increment]
  washer_id integer [not null, ref: > washers.id]
  shift_id integer [ref: > shifts.id]
  amount integer [not null, note: 'En centavos']
  reason varchar
  bonus_date date [not null]
  created_at timestamp [default: `now()`]
  updated_at timestamp
}

Table vouchers {
  id integer [pk, increment]
  voucher_number varchar [unique, not null]
  entity varchar [not null]
  amount integer [not null, note: 'En centavos']
  payment_date date [not null]
  reference_number varchar
  notes varchar
  created_at timestamp [default: `now()`]
  updated_at timestamp
}

// === CONFIGURATIONS ===
Table rates {
  id integer [pk, increment]
  vehicle_type varchar [not null]
  rate_type varchar [not null]
  price integer [not null, note: 'En centavos']
  description varchar
  is_active boolean [default: true]
  created_at timestamp [default: `now()`]
  updated_at timestamp
}

// === MONTHLY SUBSCRIPTIONS & AGREEMENTS ===
Table monthly_subscriptions {
  id integer [pk, increment]
  vehicle_id integer [not null, ref: > vehicles.id]
  start_date date [not null]
  end_date date [not null]
  monthly_fee integer [not null, note: 'En centavos']
  payment_status varchar [default: 'pending']
  notes varchar
  created_at timestamp [default: `now()`]
  updated_at timestamp
}

Table agreements {
  id integer [pk, increment]
  company_name varchar [not null]
  contact_name varchar [not null]
  contact_phone varchar
  contact_email varchar
  start_date date [not null]
  end_date date
  discount_percentage integer [default: 0]
  special_rate integer [note: 'En centavos']
  is_active varchar [default: 'active']
  notes varchar
  created_at timestamp [default: `now()`]
  updated_at timestamp
}

Table agreement_vehicles {
  id integer [pk, increment]
  agreement_id integer [not null, ref: > agreements.id]
  vehicle_id integer [not null, ref: > vehicles.id]
  created_at timestamp [default: `now()`]
  updated_at timestamp
}

// === AUDIT & NOTIFICATIONS ===
Table audit_logs {
  id integer [pk, increment]
  user_type varchar [not null]
  user_id integer [not null]
  action varchar [not null]
  entity_type varchar
  entity_id integer
  details text
  ip_address varchar
  timestamp timestamp [default: `now()`]
}

Table notifications {
  id integer [pk, increment]
  recipient_type varchar [not null]
  recipient_id integer [not null]
  notification_type varchar [not null]
  title varchar [not null]
  message text [not null]
  is_read boolean [default: false]
  read_at timestamp
  created_at timestamp [default: `now()`]
}

// === REPORTS ===
Table financial_reports {
  id integer [pk, increment]
  report_type varchar [not null]
  report_date timestamp [not null]
  generated_by integer [not null, ref: > global_admins.id]
  shift_id integer [ref: > shifts.id]
  total_income integer [default: 0]
  total_expenses integer [default: 0]
  net_profit integer [default: 0]
  parking_count integer [default: 0]
  washing_count integer [default: 0]
  subscription_count integer [default: 0]
  report_data text
  created_at timestamp [default: `now()`]
  updated_at timestamp
}

// === BUSINESS CONFIGURATION ===
Table business_config {
  id integer [pk, increment]
  config_key varchar [unique, not null]
  config_value varchar [not null]
  description varchar
  data_type varchar [default: 'string']
  is_active boolean [default: true]
  updated_by integer [not null, ref: > global_admins.id]
  created_at timestamp [default: `now()`]
  updated_at timestamp
}
